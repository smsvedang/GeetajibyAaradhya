<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counter with Sound & Vibration</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* CSS में Modal और Records Button के लिए स्टाइल जोड़े गए हैं */
        body {
            display: grid;
            place-items: center;
            min-height: 100vh;
            background-color: #e8e8f0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        .counter-container {
            position: relative;
            padding: 80px 0;
            display: grid;
            place-items: center;
        }

        .belt {
            position: absolute;
            width: 30px;
            height: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: -1;
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-image: radial-gradient(
                circle at center, 
                #e8e8f0 4px,
                transparent 4.5px
            );
            background-size: 15px 20px;
            background-repeat: repeat-y;
            background-position: center;
        }
        
        .belt-top {
            top: 0;
            border-radius: 10px 10px 0 0;
        }
        
        .belt-bottom {
            bottom: 0;
            border-radius: 0 0 10px 10px;
        }

        .finger-counter {
            width: 170px;
            height: 200px;
            background: linear-gradient(145deg, #333, #000);
            border-radius: 35px;
            border: 2px solid #111;
            box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.5), 
                        -4px -4px 10px rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
            padding: 15px;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }

        .screen {
            width: 90%;
            height: 45px;
            background-color: #c0c0c0;
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px;
            box-sizing: border-box;
            box-shadow: inset 2px 2px 4px #444, inset -1px -1px 2px #d0d0d0;
            font-family: 'Share Tech Mono', monospace;
            font-size: 2em;
            color: #1a1a1a;
        }

        .count-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(145deg, #e0e0e0, #b0b0b0);
            border: 2px solid #888;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5), 
                        -3px -3px 8px rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.1s ease;
        }

        .count-button:active {
            transform: translateY(2px);
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5), 
                        -1px -1px 3px rgba(255, 255, 255, 0.1);
            background: linear-gradient(145deg, #b0b0b0, #e0e0e0);
        }

        .button-row {
            display: flex;
            justify-content: space-between;
            width: 90%;
            margin-top: 5px;
        }
        
        .small-button {
            width: 48%;
            height: 25px;
            font-size: 10px;
            font-weight: bold;
            background-color: #444;
            color: #aaa;
            border: 1px solid #666;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            transition: all 0.1s ease;
        }

        .small-button:active {
            transform: translateY(1px);
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
        }
        
        #recordsButton {
            background-color: #3a5a9a;
            color: white;
        }
        
        /* --- लोडिंग और Modal (पॉप-अप) का स्टाइल --- */
        
        /* Modal (पॉप-अप) बैकग्राउंड */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        /* Modal का कंटेंट बॉक्स */
        .modal-content {
            background-color: #fefefe;
            margin: 20% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            position: relative;
        }

        /* Modal का क्लोज बटन (X) */
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover {
            color: #000;
        }
        
        .modal-content h2 {
            font-family: Arial, sans-serif;
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        /* रिकॉर्ड्स की लिस्ट */
        #recordsList {
            list-style-type: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
        }
        #recordsList li {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1.1em;
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center; /* डिलीट बटन को सेंटर करने के लिए */
        }
        #recordsList li:last-child {
            border-bottom: none;
        }
        #recordsList li .date {
            color: #000;
        }
        #recordsList li .count {
            color: #3a5a9a;
            font-weight: bold;
            margin-left: 10px;
        }
        
        /* --- नया डिलीट बटन स्टाइल --- */
        .delete-button {
            background-color: #d9534f; /* लाल रंग */
            color: white;
            border: none;
            border-radius: 5px; /* गोल की जगह चौकोर */
            width: auto; /* टेक्स्ट के हिसाब से चौड़ाई */
            height: 25px; /* थोड़ी ऊंचाई */
            font-size: 10px; /* छोटा फॉन्ट */
            font-weight: bold;
            cursor: pointer;
            padding: 0 8px; /* टेक्स्ट के अगल-बगल जगह */
            text-align: center;
        }
        
        .record-info {
            flex-grow: 1; /* तारीख और गिनती को लेफ्ट में रखने के लिए */
        }
        
        /* --- कन्फर्मेशन Modal के लिए नया CSS --- */
        .confirm-modal {
            display: none;
            position: fixed;
            z-index: 101; /* रिकॉर्ड्स modal के ऊपर */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* ज़्यादा डार्क */
            justify-content: center;
            align-items: center;
        }
        .confirm-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            width: 80%;
            max-width: 300px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .confirm-content p {
            font-size: 1.1em;
            color: #333;
        }
        .confirm-buttons {
            margin-top: 20px;
        }
        .confirm-buttons button {
            width: 40%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 0 5%;
        }
        #confirmYes {
            background-color: #d9534f;
            color: white;
        }
        #confirmCancel {
            background-color: #eee;
            color: #333;
        }

    </style>
</head>
<body>

    <!-- लोडिंग मैसेज हटा दिया गया है -->

    <!-- काउंटर कंटेनर अब डिफ़ॉल्ट रूप से दिखेगा -->
    <div class="counter-container" id="mainCounter">
        
        <div class="belt belt-top"></div>
        
        <div class="finger-counter">
            <div class="screen" id="display">00000</div>
            <button class="count-button" id="incrementButton"></button>
            
            <div class="button-row">
                <button class="small-button" id="resetButton">RESET</button>
                <button class="small-button" id="recordsButton">RECORDS</button>
            </div>
        </div>
        
        <div class="belt belt-bottom"></div>
    </div>

    <!-- रिकॉर्ड्स के लिए Modal (पॉप-अप) -->
    <div id="recordsModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModal">&times;</span>
            <h2>Previous Records</h2>
            <ul id="recordsList">
                <!-- रिकॉर्ड्स यहाँ JavaScript से भरे जाएँगे -->
            </ul>
        </div>
    </div>

    <!-- --- नया कन्फर्मेशन Modal HTML --- -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-content">
            <p id="confirmText">Are you sure you want to delete this record?</p>
            <div class="confirm-buttons">
                <button id="confirmCancel">Cancel</button>
                <button id="confirmYes">Yes, Delete</button>
            </div>
        </div>
    </div>


    <!-- Firebase हटा दिया गया है -->
    <script type"module">
        // --- 1. DOM एलिमेंट्स ---
        const displayElement = document.getElementById('display');
        const incrementButton = document.getElementById('incrementButton');
        const resetButton = document.getElementById('resetButton');
        const recordsButton = document.getElementById('recordsButton');
        const modal = document.getElementById('recordsModal');
        const closeModal = document.getElementById('closeModal');
        const recordsList = document.getElementById('recordsList');
        // --- नए DOM एलिमेंट्स ---
        const confirmModal = document.getElementById('confirmModal');
        const confirmYes = document.getElementById('confirmYes');
        const confirmCancel = document.getElementById('confirmCancel');
        const confirmText = document.getElementById('confirmText');
        
        // --- 2. ग्लोबल वेरिएबल्स ---
        let count = 0;
        let todayDate = getTodayDateString();
        const STORAGE_KEY = 'japCounterRecords'; // LocalStorage के लिए की
        let dateToDelete = null; // डिलीट करने वाली तारीख को सेव करने के लिए

        // --- 3. साउंड और वाइब्रेशन (पहले जैसा) ---
        let audioCtx = null;
        function playClickSound() {
            if (audioCtx === null) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.05);
        }
        function playResetSound() {
            if (audioCtx === null) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.1);
        }
        function triggerVibration(duration) {
            if ("vibrate" in navigator) navigator.vibrate(duration);
        }

        // --- 4. हेल्पर फंक्शन्स ---
        
        function getTodayDateString() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }
        
        function updateDisplay() {
            displayElement.textContent = String(count).padStart(5, '0');
        }

        // --- 5. LocalStorage लॉजिक ---
        
        // स्टोरेज से सभी रिकॉर्ड्स पाना
        function getRecords() {
            const recordsJSON = localStorage.getItem(STORAGE_KEY);
            return recordsJSON ? JSON.parse(recordsJSON) : [];
        }
        
        // रिकॉर्ड्स को स्टोरेज में सेव करना
        function saveRecords(records) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
        }
        
        // ऐप लोड होने पर आज की गिनती लोड करना
        function loadTodaysCount() {
            todayDate = getTodayDateString();
            const records = getRecords();
            const todayRecord = records.find(record => record.date === todayDate);
            
            if (todayRecord) {
                count = todayRecord.count;
            } else {
                count = 0;
            }
            updateDisplay();
        }
        
        // गिनती को LocalStorage में सेव करना
        function saveCurrentCount() {
            todayDate = getTodayDateString(); // सुनिश्चित करें कि तारीख ताज़ा है
            let records = getRecords();
            const todayIndex = records.findIndex(record => record.date === todayDate);
            
            if (todayIndex > -1) {
                // आज का रिकॉर्ड मौजूद है, उसे अपडेट करें
                records[todayIndex].count = count;
            } else {
                // आज का कोई रिकॉर्ड नहीं है, नया बनाएँ
                records.push({ date: todayDate, count: count });
            }
            
            saveRecords(records); // अपडेटेड लिस्ट को सेव करें
        }
        
        // दिन में बदलाव की जाँच करना
        function checkDayChange() {
            const newDate = getTodayDateString();
            if (newDate !== todayDate) {
                // नया दिन!
                todayDate = newDate;
                count = 0; // नए दिन के लिए गिनती रीसेट करें
                updateDisplay();
            }
        }
        
        // रिकॉर्ड्स पॉप-अप को भरना
        function populateRecordsModal() {
            recordsList.innerHTML = ''; // लिस्ट खाली करें
            let records = getRecords();
            
            // तारीख के हिसाब से सॉर्ट करें (नया पहले)
            records.sort((a, b) => b.date.localeCompare(a.date));

            if (records.length === 0) {
                 recordsList.innerHTML = '<li>No previous records found.</li>';
                 return;
            }
            
            records.forEach(record => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="record-info">
                        <span class="date">${record.date}</span>
                        <span class="count">${record.count}</span>
                    </span>
                    <button class="delete-button" data-date="${record.date}">DELETE</button>
                `;
                recordsList.appendChild(li);
            });
        }

        // --- 6. इवेंट लिस्नर्स ---

        // बड़ा बटन (गिनती)
        incrementButton.addEventListener('click', () => {
            checkDayChange();
            
            count++;
            if (count > 99999) {
                count = 0;
            }
            updateDisplay();
            saveCurrentCount();
            
            playClickSound();
            triggerVibration(50);
        });

        // रीसेट बटन
        resetButton.addEventListener('click', () => {
            checkDayChange();
            
            count = 0;
            updateDisplay();
            saveCurrentCount(); // 0 को सेव करें
            
            playResetSound();
            triggerVibration([80, 50, 80]);
        });
        
        // "Records" बटन
        recordsButton.addEventListener('click', () => {
            populateRecordsModal();
            modal.style.display = 'block';
        });
        
        // Modal को बंद करने वाले
        closeModal.onclick = () => {
            modal.style.display = "none";
        }
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        
        // --- 6. (बदला हुआ) डिलीट बटन का लॉजिक ---
        
        // डिलीट बटन के लिए इवेंट लिस्नर (Event Delegation)
        recordsList.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-button')) {
                // तारीख को सेव करें
                dateToDelete = event.target.getAttribute('data-date');
                // कन्फर्मेशन Modal दिखाएँ
                confirmText.textContent = `Are you sure you want to delete the record for ${dateToDelete}?`;
                confirmModal.style.display = 'flex';
            }
        });

        // कन्फर्मेशन Modal - "Yes" बटन
        confirmYes.addEventListener('click', () => {
            if (dateToDelete) {
                // रिकॉर्ड्स से डिलीट करें
                let records = getRecords();
                let newRecords = records.filter(record => record.date !== dateToDelete);
                saveRecords(newRecords);
                
                // Modal को रिफ्रेश करें
                populateRecordsModal();
                
                // अगर आज का रिकॉर्ड डिलीट किया है, तो मुख्य काउंटर को रीसेट करें
                if (dateToDelete === todayDate) {
                    count = 0;
                    updateDisplay();
                }
            }
            // Modal छुपाएँ और तारीख रीसेट करें
            confirmModal.style.display = 'none';
            dateToDelete = null;
        });

        // कन्फर्मेशन Modal - "Cancel" बटन
        confirmCancel.addEventListener('click', () => {
            confirmModal.style.display = 'none';
            dateToDelete = null;
        });


        // --- 7. ऐप शुरू करें ---
        loadTodaysCount();
        
    </script>

</body>
</html>