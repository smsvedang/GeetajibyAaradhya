<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="admin-style.css" />
</head>
<body>

<!-- ================= LOGIN ================= -->
<section id="login-section">
  <div class="login-card">
    <h2>Admin Login</h2>
    <form id="login-form">
      <input id="password" type="password" class="form-control" placeholder="Admin Password" required />
      <button class="btn btn-primary" style="width:100%;margin-top:1rem">Login</button>
    </form>
  </div>
</section>

<!-- ================= ADMIN ================= -->
<div id="admin-layout" class="admin-layout" style="display:none">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">⚡ Admin</div>

    <div class="nav-scroll">
      <div class="nav-item active" onclick="switchTab('dashboard')">Dashboard</div>
      <div class="nav-item" onclick="switchTab('shlokas')">Shlokas</div>
      <div class="nav-item" onclick="switchTab('blogs')">Blogs</div>
      <div class="nav-item" onclick="switchTab('artwork')">Artwork</div>
      <div class="nav-item" onclick="switchTab('testimonials')">Testimonials</div>
      <div class="nav-item" onclick="switchTab('courses')">Courses</div>
      <div class="nav-item" onclick="switchTab('quizzes')">Quizzes</div>
      <div class="nav-item" onclick="switchTab('certificates')">Certificates</div>
      <div class="nav-item" onclick="switchTab('students')">Students</div>
      <div class="nav-item" onclick="switchTab('settings')">Settings</div>
    </div>

    <div class="sidebar-footer">
      <button class="logout-btn" onclick="location.reload()">Logout</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main-wrapper">
    <header class="top-header">
      <div id="page-title" class="page-title">Dashboard</div>
    </header>

    <div class="content-scroll">

      <!-- DASHBOARD -->
      <section id="view-dashboard" class="view-section active">
        <div id="stats-grid" class="stats-grid"></div>
      </section>

      <!-- SHLOKAS -->
      <section id="view-shlokas" class="view-section">
        <button class="btn btn-primary" onclick="openShloka()">+ Add Shloka</button>
        <table>
          <thead><tr><th>Adhyay</th><th>Shloka</th><th>Actions</th></tr></thead>
          <tbody id="table-shlokas"></tbody>
        </table>
      </section>

      <!-- BLOGS -->
      <section id="view-blogs" class="view-section">
        <button class="btn btn-primary" onclick="openBlog()">+ Add Blog</button>
        <table>
          <thead><tr><th>Title</th><th>Actions</th></tr></thead>
          <tbody id="table-blogs"></tbody>
        </table>
      </section>

      <!-- ARTWORK -->
      <section id="view-artwork" class="view-section">
        <button class="btn btn-primary" onclick="openArtwork()">+ Add Artwork</button>
        <table>
          <thead><tr><th>Title</th><th>Actions</th></tr></thead>
          <tbody id="table-artwork"></tbody>
        </table>
      </section>

      <!-- TESTIMONIALS -->
      <section id="view-testimonials" class="view-section">
        <button class="btn btn-primary" onclick="openTestimonial()">+ Add Testimonial</button>
        <table>
          <thead><tr><th>Name</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody id="table-testimonials"></tbody>
        </table>
      </section>

      <!-- COURSES -->
      <section id="view-courses" class="view-section">
        <button class="btn btn-primary" onclick="openCourse()">+ Add Course</button>
        <div id="course-list"></div>
      </section>

      <!-- QUIZZES -->
      <section id="view-quizzes" class="view-section">
        <button class="btn btn-primary" onclick="openQuiz()">+ Add Quiz</button>
        <table>
          <thead><tr><th>Course</th><th>Pass %</th><th>Actions</th></tr></thead>
          <tbody id="table-quizzes"></tbody>
        </table>
      </section>

      <!-- CERTIFICATES -->
      <section id="view-certificates" class="view-section">
        <table>
          <thead><tr><th>Name</th><th>Course</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody id="table-certificates"></tbody>
        </table>
      </section>

      <!-- STUDENTS -->
      <section id="view-students" class="view-section">
        <table>
          <thead>
            <tr><th>Mobile</th><th>Courses</th><th>Quizzes Passed</th></tr>
          </thead>
          <tbody id="table-students"></tbody>
        </table>
      </section>

      <!-- SETTINGS -->
      <section id="view-settings" class="view-section">
        <textarea id="about-text" class="form-control" placeholder="About text"></textarea>
        <button class="btn btn-primary" onclick="saveAbout()">Save</button>
      </section>

    </div>
  </main>
</div>

<!-- ================= MODALS ================= -->
<div id="modal-container"></div>

<script>
/* ===== BASIC HELPERS ===== */
const qs = id => document.getElementById(id)
const qsa = q => document.querySelectorAll(q)
let ADMIN_PASSWORD = ''

function switchTab(tab){
  qsa('.view-section').forEach(v=>v.classList.remove('active'))
  qs('view-'+tab).classList.add('active')
  qs('page-title').innerText = tab.toUpperCase()
  if(window['load'+tab.charAt(0).toUpperCase()+tab.slice(1)]) {
    window['load'+tab.charAt(0).toUpperCase()+tab.slice(1)]()
  }
}

/* LOGIN */
qs('login-form').onsubmit = async e=>{
  e.preventDefault()
  ADMIN_PASSWORD = qs('password').value
  const r = await fetch('/api/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({password:ADMIN_PASSWORD})
  })
  if(!r.ok) return alert('Wrong password')
  qs('login-section').style.display='none'
  qs('admin-layout').style.display='grid'
}
</script>

</body>
</html>
<script>
/* ================================
   COMMON HELPERS
================================ */
async function api(url, method='GET', body=null){
  const opt = { method, headers:{'Content-Type':'application/json'} }
  if(body) opt.body = JSON.stringify(body)
  const r = await fetch(url, opt)
  return r.json()
}

/* ================================
   SHLOKAS
================================ */
function openShloka(s=null){
  const adhyay = prompt('Adhyay', s?.adhyay || '')
  if(!adhyay) return
  const shloka = prompt('Shloka', s?.shloka || '')
  const text = prompt('Text', s?.text || '')
  const video_id = prompt('YouTube ID', s?.video_id || '')

  api('/api/shlokas'+(s?'/' + s._id:''), s?'PUT':'POST', {
    adhyay, shloka, text, video_id, password:ADMIN_PASSWORD
  }).then(loadShlokas)
}

async function loadShlokas(){
  const tb = qs('table-shlokas')
  tb.innerHTML=''
  const data = await api('/api/shlokas')
  data.forEach(s=>{
    tb.innerHTML+=`
      <tr>
        <td>${s.adhyay}</td>
        <td>${s.shloka}</td>
        <td>
          <button onclick='openShloka(${JSON.stringify(s)})'>Edit</button>
          <button onclick="deleteShloka('${s._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function deleteShloka(id){
  if(!confirm('Delete shloka?')) return
  api('/api/shlokas/'+id,'DELETE',{password:ADMIN_PASSWORD}).then(loadShlokas)
}

/* ================================
   BLOGS
================================ */
function openBlog(b=null){
  const title = prompt('Title', b?.title || '')
  if(!title) return
  const imageUrl = prompt('Image URL', b?.imageUrl || '')
  const content = prompt('Content', b?.content || '')

  api('/api/blog'+(b?'/'+b._id:''), b?'PUT':'POST', {
    title, imageUrl, content, password:ADMIN_PASSWORD
  }).then(loadBlogs)
}

async function loadBlogs(){
  const tb = qs('table-blogs')
  tb.innerHTML=''
  const data = await api('/api/blog')
  data.forEach(b=>{
    tb.innerHTML+=`
      <tr>
        <td>${b.title}</td>
        <td>
          <button onclick='openBlog(${JSON.stringify(b)})'>Edit</button>
          <button onclick="deleteBlog('${b._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function deleteBlog(id){
  api('/api/blog/'+id,'DELETE',{password:ADMIN_PASSWORD}).then(loadBlogs)
}

/* ================================
   ARTWORK
================================ */
function openArtwork(a=null){
  const title = prompt('Title', a?.title || '')
  if(!title) return
  const imageUrl = prompt('Image URL', a?.imageUrl || '')

  api('/api/artwork'+(a?'/'+a._id:''), a?'PUT':'POST', {
    title, imageUrl, password:ADMIN_PASSWORD
  }).then(loadArtwork)
}

async function loadArtwork(){
  const tb = qs('table-artwork')
  tb.innerHTML=''
  const data = await api('/api/artwork')
  data.forEach(a=>{
    tb.innerHTML+=`
      <tr>
        <td>${a.title}</td>
        <td>
          <button onclick='openArtwork(${JSON.stringify(a)})'>Edit</button>
          <button onclick="deleteArtwork('${a._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function deleteArtwork(id){
  api('/api/artwork/'+id,'DELETE',{password:ADMIN_PASSWORD}).then(loadArtwork)
}

/* ================================
   TESTIMONIALS
================================ */
function openTestimonial(t=null){
  const author = prompt('Name', t?.author || '')
  if(!author) return
  const quote = prompt('Message', t?.quote || '')
  const status = prompt('Status (pending/approved)', t?.status || 'pending')

  api('/api/testimonials'+(t?'/'+t._id:''), t?'PUT':'POST', {
    author, quote, status, password:ADMIN_PASSWORD
  }).then(loadTestimonials)
}

async function loadTestimonials(){
  const tb = qs('table-testimonials')
  tb.innerHTML=''
  const data = await api('/api/testimonials/all')
  data.forEach(t=>{
    tb.innerHTML+=`
      <tr>
        <td>${t.author}</td>
        <td>${t.status}</td>
        <td>
          <button onclick='openTestimonial(${JSON.stringify(t)})'>Edit</button>
          <button onclick="deleteTestimonial('${t._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function deleteTestimonial(id){
  api('/api/testimonials/'+id,'DELETE',{password:ADMIN_PASSWORD}).then(loadTestimonials)
}

/* ================================
   COURSES  ✅ FIXED openCourse
================================ */
function openCourse(c=null){
  const title = prompt('Course Title', c?.title || '')
  if(!title) return
  const adhyay = prompt('Adhyay', c?.adhyay || '')
  const description = prompt('Description', c?.description || '')
  const imageUrl = prompt('Image URL', c?.imageUrl || '')

  api('/api/courses'+(c?'/'+c._id:''), c?'PUT':'POST', {
    title, adhyay, description, imageUrl, shlokas:[],
    password:ADMIN_PASSWORD
  }).then(loadCourses)
}

async function loadCourses(){
  const box = qs('course-list')
  box.innerHTML=''
  const data = await api('/api/courses')
  data.forEach(c=>{
    box.innerHTML+=`
      <div style="margin:10px 0">
        <b>${c.title}</b>
        <button onclick='openCourse(${JSON.stringify(c)})'>Edit</button>
        <button onclick="deleteCourse('${c._id}')">Delete</button>
      </div>`
  })
}

function deleteCourse(id){
  if(!confirm('Delete course?')) return
  fetch('/api/courses/'+id,{method:'DELETE'}).then(loadCourses)
}

/* ================================
   QUIZZES  ✅ FIXED openQuiz
================================ */
function openQuiz(q=null){
  const courseId = prompt('Course ID', q?.course || '')
  if(!courseId) return
  const passPercentage = prompt('Pass %', q?.passPercentage || 50)

  api('/api/quiz', 'POST', {
    course: courseId,
    passPercentage,
    questions: [],
    password: ADMIN_PASSWORD
  }).then(loadQuizzes)
}

async function loadQuizzes(){
  const tb = qs('table-quizzes')
  tb.innerHTML=''
  const data = await api('/api/quiz')
  data.forEach(q=>{
    tb.innerHTML+=`
      <tr>
        <td>${q.course?.title || q.course}</td>
        <td>${q.passPercentage}%</td>
        <td>
          <button onclick="deleteQuiz('${q._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function deleteQuiz(id){
  api('/api/quiz/'+id,'DELETE',{password:ADMIN_PASSWORD}).then(loadQuizzes)
}

/* ================================
   CERTIFICATES
================================ */
async function loadCertificates(){
  const tb = qs('table-certificates')
  tb.innerHTML=''
  const data = await api('/api/certificates')
  data.forEach(c=>{
    tb.innerHTML+=`
      <tr>
        <td>${c.name}</td>
        <td>${c.courseTitle}</td>
        <td>${c.status}</td>
        <td>
          <button onclick="approveCert('${c._id}')">Approve</button>
          <button onclick="deleteCert('${c._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function approveCert(id){
  api('/api/certificates/approve/'+id,'PUT').then(loadCertificates)
}

function deleteCert(id){
  api('/api/certificates/'+id,'DELETE').then(loadCertificates)
}

/* ================================
   STUDENTS
================================ */
async function loadStudents(){
  const tb = qs('table-students')
  tb.innerHTML=''
  const data = await api('/api/admin/detailed-students')
  data.forEach(s=>{
    tb.innerHTML+=`
      <tr>
        <td>${s._id}</td>
        <td>${s.coursesEnrolled}</td>
        <td>${s.quizzesPassed}</td>
      </tr>`
  })
}

/* ================================
   SETTINGS
================================ */
async function saveAbout(){
  const text = qs('about-text').value
  api('/api/about','POST',{
    newText:text,
    password:ADMIN_PASSWORD
  }).then(()=>alert('Saved'))
}
</script>
