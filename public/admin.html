<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel ‚Äì Warrior Aaradhya</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="admin-style.css">
</head>
<body>

<!-- ================= LOGIN ================= -->
<section id="login-section">
  <div class="login-card">
    <h2>Admin Login</h2>
    <p>Authorized access only</p>

    <form id="login-form">
      <input
        type="password"
        id="password"
        class="form-control"
        placeholder="Admin Password"
        required
      />
      <button class="btn btn-primary" style="width:100%;margin-top:1rem">
        Login
      </button>
    </form>
  </div>
</section>

<!-- ================= ADMIN LAYOUT ================= -->
<div id="admin-layout" class="admin-layout" style="display:none">

<!-- ========== SIDEBAR ========== -->
<aside class="sidebar">
  <div class="brand">‚ö° ADMIN PANEL</div>

  <div class="nav-scroll">

    <div class="nav-group">
      <div class="nav-label">Overview</div>
      <div class="nav-item active" data-tab="dashboard">Analytics</div>
    </div>

    <div class="nav-group">
      <div class="nav-label">Content</div>
      <div class="nav-item" data-tab="shlokas">Shlokas</div>
      <div class="nav-item" data-tab="blogs">Blogs</div>
      <div class="nav-item" data-tab="artwork">Artwork</div>
      <div class="nav-item" data-tab="testimonials">Testimonials</div>
    </div>

    <div class="nav-group">
      <div class="nav-label">System</div>
      <div class="nav-item" data-tab="push">Push Notifications</div>
      <div class="nav-item" data-tab="backup">Backup / Export</div>
    </div>

  </div>

  <div class="sidebar-footer">
    <button class="logout-btn" onclick="location.reload()">Logout</button>
  </div>
</aside>

<!-- ========== MAIN ========== -->
<main class="main-wrapper">

<header class="top-header">
  <div id="page-title" class="page-title">Analytics</div>
</header>

<div class="content-scroll">

<!-- ================= ANALYTICS DASHBOARD ================= -->
<section id="view-dashboard" class="view-section active">

  <div class="stats-grid" id="stats-grid">
    <!-- JS se cards aayenge -->
  </div>

  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Recent Activity (Auto)</div>
    </div>

    <div style="padding:1.5rem;color:#64748b;font-size:0.9rem">
      ‚úî New shloka ‚Üí push auto<br>
      ‚úî New blog ‚Üí push auto<br>
      ‚úî Likes ‚Üí tracked automatically<br>
      ‚úî Certificates ‚Üí auto generated
    </div>
  </div>

</section>

<!-- ================= SHLOKAS ================= -->
<section id="view-shlokas" class="view-section">
  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Shlokas</div>
      <button class="btn btn-primary" onclick="addShloka()">+ Add Shloka</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Adhyay</th>
          <th>Shloka</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="shloka-table"></tbody>
    </table>
  </div>
</section>

<!-- ================= BLOGS ================= -->
<section id="view-blogs" class="view-section">
  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Blogs</div>
      <button class="btn btn-primary" onclick="addBlog()">+ Add Blog</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="blog-table"></tbody>
    </table>
  </div>
</section>

<!-- ================= ARTWORK ================= -->
<section id="view-artwork" class="view-section">
  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Artwork</div>
      <button class="btn btn-primary" onclick="addArtwork()">+ Add Artwork</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Likes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="artwork-table"></tbody>
    </table>
  </div>
</section>

<!-- ================= TESTIMONIALS ================= -->
<section id="view-testimonials" class="view-section">
  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Testimonials</div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="testimonial-table"></tbody>
    </table>
  </div>
</section>
<!-- ================= PUSH NOTIFICATIONS ================= -->
<section id="view-push" class="view-section">
  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Send Push Notification</div>
    </div>

    <div style="padding:1.5rem">
      <input
        id="push-title"
        class="form-control"
        placeholder="Notification title"
      />

      <textarea
        id="push-body"
        class="form-control"
        placeholder="Notification message"
        style="margin-top:1rem"
      ></textarea>

      <button
        class="btn btn-primary"
        style="margin-top:1rem"
        onclick="sendPush()"
      >
        üöÄ Send Notification
      </button>

      <p id="push-status" style="margin-top:0.75rem;font-size:0.85rem"></p>
    </div>
  </div>
</section>

<!-- ================= BACKUP / EXPORT ================= -->
<section id="view-backup" class="view-section">
  <div class="data-card">
    <div class="card-header">
      <div class="card-title">Backup / Export Data</div>
    </div>

    <div style="padding:1.5rem">
      <p style="color:#64748b;font-size:0.9rem">
        Download complete database data in JSON format.
      </p>

      <button class="btn btn-primary" onclick="exportData()">
        ‚¨á Export All Data
      </button>
    </div>
  </div>
</section>

</div>
</main>
</div>

<!-- ================= CORE SCRIPT ================= -->
<script>
/* ========= HELPERS ========= */
const qs = id => document.getElementById(id)
const qsa = q => document.querySelectorAll(q)
let ADMIN_PASSWORD = ''

async function api(url, method='GET', body=null){
  const opt = { method, headers:{'Content-Type':'application/json'} }
  if(body) opt.body = JSON.stringify(body)
  const r = await fetch(url, opt)
  if(!r.ok) throw new Error('API error')
  return r.json()
}

/* ========= LOGIN ========= */
qs('login-form').onsubmit = async e => {
  e.preventDefault()
  ADMIN_PASSWORD = qs('password').value

  try{
    await api('/api/login','POST',{password:ADMIN_PASSWORD})
    qs('login-section').style.display='none'
    qs('admin-layout').style.display='grid'
    loadAnalytics()
  }catch{
    alert('Wrong password')
  }
}

/* ========= SIDEBAR ========= */
qsa('.nav-item').forEach(item=>{
  item.onclick = ()=>{
    qsa('.nav-item').forEach(n=>n.classList.remove('active'))
    item.classList.add('active')

    const tab = item.dataset.tab
    qsa('.view-section').forEach(v=>v.classList.remove('active'))
    qs('view-'+tab).classList.add('active')

    qs('page-title').innerText = tab.toUpperCase()

    if(tab==='dashboard') loadAnalytics()
  }
})

/* ========= ANALYTICS ========= */
async function loadAnalytics(){
  const grid = qs('stats-grid')
  grid.innerHTML=''

  const map = {
    Shlokas:'/api/shlokas',
    Blogs:'/api/blog',
    Artwork:'/api/artwork',
    Courses:'/api/courses',
    Certificates:'/api/certificates'
  }

  for(const k in map){
    const d = await api(map[k])
    grid.innerHTML += `
      <div class="stat-card">
        <div class="stat-head">${k}</div>
        <div class="stat-value">${d.length}</div>
      </div>`
  }
}
</script>
<script>
/* ================= SHLOKAS ================= */
async function loadShlokas(){
  const tb = qs('shloka-table')
  tb.innerHTML=''
  const data = await api('/api/shlokas')

  data.forEach(s=>{
    tb.innerHTML+=`
      <tr>
        <td>${s.adhyay}</td>
        <td>${s.shloka}</td>
        <td>
          <button onclick="editShloka('${s._id}')">Edit</button>
          <button onclick="deleteShloka('${s._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function addShloka(){
  const adhyay = prompt('Adhyay number')
  const shloka = prompt('Shloka number')
  const text = prompt('Shloka text')
  const video = prompt('YouTube Video ID')
  if(!adhyay||!shloka||!video) return

  api('/api/shlokas','POST',{
    adhyay, shloka, text, video_id:video,
    password:ADMIN_PASSWORD
  }).then(loadShlokas)
}

function editShloka(id){
  api('/api/shloka/'+id).then(s=>{
    const text = prompt('Edit text',s.text||'')
    api('/api/shlokas/'+id,'PUT',{
      adhyay:s.adhyay,
      shloka:s.shloka,
      text,
      video_id:s.video_id,
      password:ADMIN_PASSWORD
    }).then(loadShlokas)
  })
}

function deleteShloka(id){
  if(!confirm('Delete shloka?'))return
  api('/api/shlokas/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadShlokas)
}

/* ================= BLOGS ================= */
async function loadBlogs(){
  const tb = qs('blog-table')
  tb.innerHTML=''
  const data = await api('/api/blog')

  data.forEach(b=>{
    tb.innerHTML+=`
      <tr>
        <td>${b.title}</td>
        <td>${new Date(b.createdAt).toLocaleDateString('en-IN')}</td>
        <td>
          <button onclick="deleteBlog('${b._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function addBlog(){
  const title = prompt('Title')
  const content = prompt('Content')
  const image = prompt('Image URL')
  if(!title||!content)return

  api('/api/blog','POST',{
    title, content, imageUrl:image,
    password:ADMIN_PASSWORD
  }).then(loadBlogs)
}

function deleteBlog(id){
  if(!confirm('Delete blog?'))return
  api('/api/blog/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadBlogs)
}

/* ================= ARTWORK ================= */
async function loadArtwork(){
  const tb = qs('artwork-table')
  tb.innerHTML=''
  const data = await api('/api/artwork')

  data.forEach(a=>{
    tb.innerHTML+=`
      <tr>
        <td>${a.title}</td>
        <td>${a.likes||0}</td>
        <td>
          <button onclick="deleteArtwork('${a._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function addArtwork(){
  const title = prompt('Artwork title')
  const image = prompt('Image URL')
  if(!title||!image)return

  api('/api/artwork','POST',{
    title,imageUrl:image,
    password:ADMIN_PASSWORD
  }).then(loadArtwork)
}

function deleteArtwork(id){
  if(!confirm('Delete artwork?'))return
  api('/api/artwork/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadArtwork)
}

/* ================= TESTIMONIALS ================= */
async function loadTestimonials(){
  const tb = qs('testimonial-table')
  tb.innerHTML=''
  const data = await api('/api/testimonials/all')

  data.forEach(t=>{
    tb.innerHTML+=`
      <tr>
        <td>${t.author}</td>
        <td>${t.status}</td>
        <td>
          <button onclick="approveTestimonial('${t._id}')">Approve</button>
          <button onclick="deleteTestimonial('${t._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function approveTestimonial(id){
  api('/api/testimonials/'+id,'PUT',{
    status:'approved',
    password:ADMIN_PASSWORD
  }).then(loadTestimonials)
}

function deleteTestimonial(id){
  if(!confirm('Delete testimonial?'))return
  api('/api/testimonials/'+id,'DELETE',{
    password:ADMIN_PASSWORD
  }).then(loadTestimonials)
}

/* ========= TAB LOAD HOOK ========= */
const cmsLoaders={
  shlokas:loadShlokas,
  blogs:loadBlogs,
  artwork:loadArtwork,
  testimonials:loadTestimonials
}

qsa('.nav-item').forEach(i=>{
  i.addEventListener('click',()=>{
    const tab=i.dataset.tab
    cmsLoaders[tab]?.()
  })
})
</script>
<script>
/* ================= PUSH ================= */
async function sendPush(){
  const title = qs('push-title').value.trim()
  const body  = qs('push-body').value.trim()
  const status = qs('push-status')

  if(!title || !body){
    status.innerText = '‚ö†Ô∏è Title and message required'
    return
  }

  status.innerText = 'Sending...'

  try{
    await api('/api/push/send','POST',{
      title,
      body,
      password:ADMIN_PASSWORD
    })
    status.innerText = '‚úÖ Notification sent'
    qs('push-title').value=''
    qs('push-body').value=''
  }catch{
    status.innerText = '‚ùå Failed to send notification'
  }
}

/* ================= BACKUP / EXPORT ================= */
async function exportData(){
  const data = {}

  const endpoints = {
    shlokas:'/api/shlokas',
    blogs:'/api/blog',
    artwork:'/api/artwork',
    courses:'/api/courses',
    certificates:'/api/certificates'
  }

  for(const key in endpoints){
    data[key] = await api(endpoints[key])
  }

  const blob = new Blob(
    [JSON.stringify(data,null,2)],
    { type:'application/json' }
  )

  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `backup-${new Date().toISOString().slice(0,10)}.json`
  a.click()
  URL.revokeObjectURL(url)
}
</script>
</body>
</html>
