<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="admin-style.css">
</head>
<body>

<!-- ========== LOGIN ========== -->
<section id="login-section">
  <div class="login-card">
    <h2>Admin Login</h2>
    <form id="login-form">
      <input id="password" type="password" class="form-control" placeholder="Admin Password" required>
      <button class="btn btn-primary" style="width:100%;margin-top:1rem">Login</button>
    </form>
  </div>
</section>

<!-- ========== ADMIN LAYOUT ========== -->
<div id="admin-layout" class="admin-layout" style="display:none">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="brand">âš¡ Admin Panel</div>

  <div class="nav-scroll">
    <div class="nav-group">
      <div class="nav-label">Overview</div>
      <div class="nav-item active" onclick="switchTab('dashboard')">Dashboard</div>
    </div>

    <div class="nav-group">
      <div class="nav-label">CMS</div>
      <div class="nav-item" onclick="switchTab('shlokas')">Shlokas</div>
      <div class="nav-item" onclick="switchTab('blogs')">Blogs</div>
      <div class="nav-item" onclick="switchTab('artwork')">Artwork</div>
      <div class="nav-item" onclick="switchTab('testimonials')">Testimonials</div>
    </div>

    <div class="nav-group">
      <div class="nav-label">LMS</div>
      <div class="nav-item" onclick="switchTab('courses')">Courses</div>
      <div class="nav-item" onclick="switchTab('quizzes')">Quizzes</div>
      <div class="nav-item" onclick="switchTab('certificates')">Certificates</div>
      <div class="nav-item" onclick="switchTab('students')">Students</div>
    </div>

    <div class="nav-group">
      <div class="nav-label">System</div>
      <div class="nav-item" onclick="switchTab('settings')">Settings</div>
    </div>
  </div>

  <div class="sidebar-footer">
    <button class="logout-btn" onclick="location.reload()">Logout</button>
  </div>
</aside>

<!-- MAIN -->
<main class="main-wrapper">
<header class="top-header">
  <div id="page-title" class="page-title">Dashboard</div>
</header>

<div class="content-scroll">

<section id="view-dashboard" class="view-section active">
  <div id="stats-grid" class="stats-grid"></div>
</section>

<section id="view-shlokas" class="view-section">
  <button class="btn btn-primary" onclick="openShloka()">+ Add Shloka</button>
  <table><tbody id="table-shlokas"></tbody></table>
</section>

<section id="view-blogs" class="view-section">
  <button class="btn btn-primary" onclick="openBlog()">+ Add Blog</button>
  <table><tbody id="table-blogs"></tbody></table>
</section>

<section id="view-artwork" class="view-section">
  <button class="btn btn-primary" onclick="openArtwork()">+ Add Artwork</button>
  <table><tbody id="table-artwork"></tbody></table>
</section>

<section id="view-testimonials" class="view-section">
  <button class="btn btn-primary" onclick="openTestimonial()">+ Add Testimonial</button>
  <table><tbody id="table-testimonials"></tbody></table>
</section>

<section id="view-courses" class="view-section">
  <button class="btn btn-primary" onclick="openCourse()">+ Add Course</button>
  <div id="course-list"></div>
</section>

<section id="view-quizzes" class="view-section">
  <button class="btn btn-primary" onclick="openQuiz()">+ Create Quiz</button>
  <table><tbody id="quiz-table"></tbody></table>
</section>

<section id="view-certificates" class="view-section">
  <table><tbody id="cert-table"></tbody></table>
</section>

<section id="view-students" class="view-section">
  <table><tbody id="student-table"></tbody></table>
</section>

<section id="view-settings" class="view-section">
  <textarea id="about-text" class="form-control"></textarea>
  <button class="btn btn-primary" onclick="saveAbout()">Save</button>
</section>

</div>
</main>
</div>

<script>
const qs = id => document.getElementById(id)
const qsa = q => document.querySelectorAll(q)
let ADMIN_PASSWORD = ''
</script>

</body>
</html>
<script>
/* =========================
   API HELPER
========================= */
async function api(url, method='GET', body=null){
  const opt = { method, headers:{'Content-Type':'application/json'} }
  if(body) opt.body = JSON.stringify(body)
  const r = await fetch(url, opt)
  return r.json()
}

/* =========================
   LOGIN
========================= */
qs('login-form').onsubmit = async e => {
  e.preventDefault()
  ADMIN_PASSWORD = qs('password').value

  const r = await fetch('/api/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ password: ADMIN_PASSWORD })
  })

  if(!r.ok) return alert('Wrong password')

  qs('login-section').style.display = 'none'
  qs('admin-layout').style.display = 'grid'
  switchTab('dashboard')
}

/* =========================
   SIDEBAR NAV
========================= */
function switchTab(tab){
  qsa('.view-section').forEach(v => v.classList.remove('active'))
  qs('view-' + tab).classList.add('active')
  qs('page-title').innerText = tab.toUpperCase()

  const loaders = {
    dashboard: loadDashboard,
    shlokas: loadShlokas,
    blogs: loadBlogs,
    artwork: loadArtwork,
    testimonials: loadTestimonials,
    courses: loadCourses,
    quizzes: loadQuizzes,
    certificates: loadCertificates,
    students: loadStudents,
    settings: loadSettings
  }
  loaders[tab]?.()
}

/* =========================
   DASHBOARD
========================= */
async function loadDashboard(){
  const grid = qs('stats-grid')
  grid.innerHTML = ''

  const map = {
    Shlokas:'/api/shlokas',
    Blogs:'/api/blog',
    Artwork:'/api/artwork',
    Courses:'/api/courses',
    Certificates:'/api/certificates'
  }

  for(const k in map){
    const d = await api(map[k])
    grid.innerHTML += `
      <div class="stat-card">
        <div class="stat-head">${k}</div>
        <div class="stat-value">${d.length || 0}</div>
      </div>`
  }
}

/* =========================
   SHLOKAS
========================= */
function openShloka(s=null){
  const a = prompt('Adhyay', s?.adhyay || '')
  if(!a) return
  const sh = prompt('Shloka', s?.shloka || '')
  const t = prompt('Text', s?.text || '')
  const v = prompt('YouTube ID', s?.video_id || '')

  api('/api/shlokas' + (s?'/'+s._id:''), s?'PUT':'POST',{
    adhyay:a, shloka:sh, text:t, video_id:v,
    password:ADMIN_PASSWORD
  }).then(loadShlokas)
}

async function loadShlokas(){
  const tb = qs('table-shlokas')
  tb.innerHTML = ''
  const d = await api('/api/shlokas')
  d.forEach(s=>{
    tb.innerHTML += `
      <tr>
        <td>${s.adhyay}</td>
        <td>${s.shloka}</td>
        <td>
          <button onclick='openShloka(${JSON.stringify(s)})'>Edit</button>
          <button onclick="deleteShloka('${s._id}')">Delete</button>
        </td>
      </tr>`
  })
}
function deleteShloka(id){
  api('/api/shlokas/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadShlokas)
}

/* =========================
   BLOGS
========================= */
function openBlog(b=null){
  const t = prompt('Title', b?.title || '')
  if(!t) return
  const c = prompt('Content', b?.content || '')
  const i = prompt('Image URL', b?.imageUrl || '')

  api('/api/blog'+(b?'/'+b._id:''), b?'PUT':'POST',{
    title:t, content:c, imageUrl:i,
    password:ADMIN_PASSWORD
  }).then(loadBlogs)
}

async function loadBlogs(){
  const tb = qs('table-blogs')
  tb.innerHTML = ''
  const d = await api('/api/blog')
  d.forEach(b=>{
    tb.innerHTML += `
      <tr>
        <td>${b.title}</td>
        <td>
          <button onclick='openBlog(${JSON.stringify(b)})'>Edit</button>
          <button onclick="deleteBlog('${b._id}')">Delete</button>
        </td>
      </tr>`
  })
}
function deleteBlog(id){
  api('/api/blog/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadBlogs)
}

/* =========================
   ARTWORK
========================= */
function openArtwork(a=null){
  const t = prompt('Title', a?.title || '')
  if(!t) return
  const i = prompt('Image URL', a?.imageUrl || '')

  api('/api/artwork'+(a?'/'+a._id:''), a?'PUT':'POST',{
    title:t, imageUrl:i,
    password:ADMIN_PASSWORD
  }).then(loadArtwork)
}

async function loadArtwork(){
  const tb = qs('table-artwork')
  tb.innerHTML = ''
  const d = await api('/api/artwork')
  d.forEach(a=>{
    tb.innerHTML += `
      <tr>
        <td>${a.title}</td>
        <td>
          <button onclick='openArtwork(${JSON.stringify(a)})'>Edit</button>
          <button onclick="deleteArtwork('${a._id}')">Delete</button>
        </td>
      </tr>`
  })
}
function deleteArtwork(id){
  api('/api/artwork/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadArtwork)
}

/* =========================
   TESTIMONIALS
========================= */
function openTestimonial(t=null){
  const n = prompt('Name', t?.author || '')
  const q = prompt('Quote', t?.quote || '')
  const s = prompt('Status', t?.status || 'pending')

  api('/api/testimonials'+(t?'/'+t._id:''), t?'PUT':'POST',{
    author:n, quote:q, status:s,
    password:ADMIN_PASSWORD
  }).then(loadTestimonials)
}

async function loadTestimonials(){
  const tb = qs('table-testimonials')
  tb.innerHTML = ''
  const d = await api('/api/testimonials/all')
  d.forEach(t=>{
    tb.innerHTML += `
      <tr>
        <td>${t.author}</td>
        <td>${t.status}</td>
        <td>
          <button onclick='openTestimonial(${JSON.stringify(t)})'>Edit</button>
          <button onclick="deleteTestimonial('${t._id}')">Delete</button>
        </td>
      </tr>`
  })
}
function deleteTestimonial(id){
  api('/api/testimonials/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadTestimonials)
}

/* =========================
   COURSES
========================= */
function openCourse(c=null){
  const t = prompt('Title', c?.title || '')
  if(!t) return
  const a = prompt('Adhyay', c?.adhyay || '')
  const d = prompt('Description', c?.description || '')
  const i = prompt('Image URL', c?.imageUrl || '')

  api('/api/courses'+(c?'/'+c._id:''), c?'PUT':'POST',{
    title:t, adhyay:a, description:d, imageUrl:i,
    shlokas:[], password:ADMIN_PASSWORD
  }).then(loadCourses)
}

async function loadCourses(){
  const box = qs('course-list')
  box.innerHTML = ''
  const d = await api('/api/courses')
  d.forEach(c=>{
    box.innerHTML += `
      <div>
        <b>${c.title}</b>
        <button onclick='openCourse(${JSON.stringify(c)})'>Edit</button>
        <button onclick="deleteCourse('${c._id}')">Delete</button>
      </div>`
  })
}
function deleteCourse(id){
  fetch('/api/courses/'+id,{method:'DELETE'})
    .then(loadCourses)
}

/* =========================
   QUIZZES (LIST ONLY)
========================= */
async function loadQuizzes(){
  const tb = qs('quiz-table')
  tb.innerHTML = ''
  const d = await api('/api/quiz')
  d.forEach(q=>{
    tb.innerHTML += `
      <tr>
        <td>${q.course?.title || q.course}</td>
        <td>${q.passPercentage}%</td>
        <td>
          <button onclick="deleteQuiz('${q._id}')">Delete</button>
        </td>
      </tr>`
  })
}
function deleteQuiz(id){
  api('/api/quiz/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadQuizzes)
}

/* =========================
   CERTIFICATES (DOWNLOAD IN PART 3)
========================= */
async function loadCertificates(){
  const tb = qs('cert-table')
  tb.innerHTML = ''
  const d = await api('/api/certificates')
  d.forEach(c=>{
    tb.innerHTML += `
      <tr>
        <td>${c.name}</td>
        <td>${c.courseTitle}</td>
        <td>${c.status}</td>
        <td>
          <button onclick="approveCert('${c._id}')">Approve</button>
          <button onclick="deleteCert('${c._id}')">Delete</button>
        </td>
      </tr>`
  })
}
function approveCert(id){
  api('/api/certificates/approve/'+id,'PUT')
    .then(loadCertificates)
}
function deleteCert(id){
  api('/api/certificates/'+id,'DELETE')
    .then(loadCertificates)
}

/* =========================
   STUDENTS
========================= */
async function loadStudents(){
  const tb = qs('student-table')
  tb.innerHTML = ''
  const d = await api('/api/admin/detailed-students')
  d.forEach(s=>{
    tb.innerHTML += `
      <tr>
        <td>${s._id}</td>
        <td>${s.coursesEnrolled}</td>
        <td>${s.quizzesPassed}</td>
      </tr>`
  })
}

/* =========================
   SETTINGS
========================= */
async function loadSettings(){
  const a = await api('/api/about')
  qs('about-text').value = a.content || ''
}
function saveAbout(){
  api('/api/about','POST',{
    newText:qs('about-text').value,
    password:ADMIN_PASSWORD
  }).then(()=>alert('Saved'))
}
</script>
<script>
/* ==================================================
   QUIZ MCQ EDITOR (ADD / EDIT)
================================================== */

let QUIZ_QUESTIONS = []

// Open Quiz Editor (Add / Edit)
async function openQuiz(q=null){
  // reuse existing modal-less flow (simple + stable)
  // If you want modal UI later, yahi logic reuse hoga
  const course = prompt('Course ID', q?.course?._id || q?.course || '')
  if(!course) return

  const pass = prompt('Pass Percentage', q?.passPercentage || 50)

  QUIZ_QUESTIONS = q?.questions
    ? JSON.parse(JSON.stringify(q.questions))
    : []

  // Add questions interactively
  let addMore = true
  while(addMore){
    const ques = prompt('Question (Cancel to stop)')
    if(!ques) break

    const options = []
    for(let i=1;i<=4;i++){
      options.push(prompt(`Option ${i}`) || '')
    }
    const correctIndex = Number(prompt('Correct option index (0-3)',0))

    QUIZ_QUESTIONS.push({
      question: ques,
      options,
      correctIndex
    })
  }

  // Save quiz
  await api('/api/quiz','POST',{
    course,
    passPercentage: pass,
    questions: QUIZ_QUESTIONS,
    password: ADMIN_PASSWORD
  })

  alert('Quiz saved')
  loadQuizzes()
}

/* ==================================================
   QUIZ LIST (EDIT + DELETE)
================================================== */
async function loadQuizzes(){
  const tb = qs('quiz-table')
  tb.innerHTML = ''
  const d = await api('/api/quiz')

  d.forEach(q=>{
    tb.innerHTML += `
      <tr>
        <td>${q.course?.title || q.course}</td>
        <td>${q.passPercentage}%</td>
        <td>
          <button onclick='openQuiz(${JSON.stringify(q)})'>Edit</button>
          <button onclick="deleteQuiz('${q._id}')">Delete</button>
        </td>
      </tr>`
  })
}

/* ==================================================
   CERTIFICATE DOWNLOAD BUTTON
================================================== */
async function loadCertificates(){
  const tb = qs('cert-table')
  tb.innerHTML = ''
  const d = await api('/api/certificates')

  d.forEach(c=>{
    tb.innerHTML += `
      <tr>
        <td>${c.name}</td>
        <td>${c.courseTitle}</td>
        <td>${c.status}</td>
        <td>
          ${c.status === 'approved'
            ? `<button onclick="downloadCertificate('${c.mobile}','${c.courseTitle}')">
                Download
               </button>`
            : ''
          }
          <button onclick="approveCert('${c._id}')">Approve</button>
          <button onclick="deleteCert('${c._id}')">Delete</button>
        </td>
      </tr>`
  })
}

function downloadCertificate(mobile, courseTitle){
  const url =
    `/api/certificate?mobile=${encodeURIComponent(mobile)}&courseTitle=${encodeURIComponent(courseTitle)}`
  window.open(url, '_blank')
}

/* ==================================================
   FINAL SAFETY CHECKS (OPTIONAL BUT GOOD)
================================================== */
function deleteQuiz(id){
  if(!confirm('Delete quiz?')) return
  api('/api/quiz/'+id,'DELETE',{password:ADMIN_PASSWORD})
    .then(loadQuizzes)
}
</script>
