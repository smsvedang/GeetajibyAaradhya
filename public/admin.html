<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="admin-style.css"> 
</head>
<body>

    <div id="login-section">
        <form id="login-form">
            <h2>Admin Login</h2>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </div>

    <div id="admin-dashboard" class="admin-wrapper" style="display:none;">

        <aside class="sidebar">
            <div class="sidebar-header">
                Admin Panel
            </div>
            <nav class="sidebar-nav">
                <button class="sidebar-button active" data-tab="tab-dashboard">Dashboard</button>
                <button class="sidebar-button" data-tab="tab-testimonials">Testimonials</button>
                <button class="sidebar-button" data-tab="tab-shloka">Manage Shlokas</button>
                <button class="sidebar-button" data-tab="tab-blog">Manage Blog</button>
                <button class="sidebar-button" data-tab="tab-artwork">Manage Artwork</button>
                <button class="sidebar-button" data-tab="tab-courses">Manage Courses</button>
                <button class="sidebar-button" data-tab="tab-quizzes">Manage Quizzes</button>
                <button class="sidebar-button" data-tab="tab-certificates"> Manage Certificate</button>
                <button class="sidebar-button" data-tab="tab-about">Site Settings (About)</button>
            </nav>
        </aside>

        <main class="main-content">

            <div id="tab-dashboard" class="content-page active">
                <h1 class="page-header">Dashboard</h1>
                <div class="dashboard-stats">
                    <div class="stat-card pending">
                        <h3>Pending Testimonials</h3>
                        <span class="stat-number" id="stat-pending">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total Shlokas</h3>
                        <span class="stat-number" id="stat-shlokas">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total Likes</h3>
                        <span class="stat-number" id="stat-likes">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Blog Posts</h3>
                        <span class="stat-number" id="stat-blog">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Artworks</h3>
                        <span class="stat-number" id="stat-artwork">0</span>
                    </div>
                </div>
            </div>

            <div id="tab-testimonials" class="content-page">
                <h1 class="page-header">Manage Testimonials</h1>
                <h2 id="testimonial-form-title">Add New Testimonial (Manually)</h2>
                <form id="testimonial-form">
                    <input type="hidden" id="testimonial-id" value="">
                    <input type="text" id="testimonial-author" placeholder="Author (e.g., Smt. Sharma)" required>
                    <textarea id="testimonial-quote" placeholder="Testimonial quote..." rows="5" required></textarea>
                    <button type="submit" id="testimonial-submit-button">Add Testimonial</button>
                    <button type="button" id="testimonial-cancel-edit" class="cancel-button" style="display: none;">Cancel Edit</button>
                </form>
                
                <h2 style="color: var(--primary-color);">Pending Requests</h2>
                <div class="admin-item-list" id="testimonial-list-pending"></div>
                
                <h2 style="margin-top: 30px; color: var(--green);">Approved Testimonials</h2>
                <div class="admin-item-list" id="testimonial-list-approved"></div>
            </div>

    <div id="tab-courses" class="content-page">

    <h1 class="page-header">Manage Courses</h1>

    <!-- ADD COURSE BUTTON -->
    <button id="show-course-form" class="primary-btn">
        âž• Add Course
    </button>

    <!-- COURSE FORM (HIDDEN BY DEFAULT) -->
    <div id="course-form-wrapper" style="display:none; margin-top:20px;">
        <form id="course-form">

            <input type="text"
                   id="course-title"
                   placeholder="Course Title"
                   required>

            <textarea id="course-description"
                      rows="3"
                      placeholder="Course Description"></textarea>

            <label>Select Adhyay</label>
            <select id="course-adhyay" required>
                <option value="">Select Adhyay</option>
            </select>

            <label>Select Shlokas</label>
            <div id="course-shloka-list"></div>

            <button type="submit" class="primary-btn">
                Save Course
            </button>

            <button type="button"
                    id="cancel-course-form"
                    class="cancel-button">
                Cancel
            </button>

        </form>
    </div>

    <!-- COURSE LIST -->
    <div class="admin-item-list" id="course-list"></div>
<h3>Enrolled / In Progress Users</h3>
<div id="course-users"></div>
</div>

<div id="tab-quizzes" class="content-page">
    <h3 style="margin-top:30px;">Existing Quizzes</h3>
<div id="quiz-list" class="admin-item-list"></div>
    <h1 class="page-header">Manage Quizzes</h1>

    <form id="quiz-form">

        <label>Select Course</label>
        <select id="quiz-course" required></select>

        <input type="number"
               id="quiz-pass"
               value="50"
               placeholder="Passing Marks (%)"
               required>

        <h3>Questions</h3>
        <div id="quiz-questions"></div>

        <button type="button"
                id="add-question"
                class="primary-btn">
            âž• Add Question
        </button>

        <br><br>

        <button type="submit"
                class="primary-btn">
            ðŸ’¾ Save Quiz
        </button>

    </form>

</div>

            <div id="tab-certificates" class="content-page">
    <h1 class="page-header">Manage Certificates</h1>

    <h3>Generate New Certificate</h3>
    <form id="admin-certificate-form">
        <input id="cert-name" placeholder="Student Name" required>
        <input id="cert-mobile" placeholder="Mobile" required>
        <input id="cert-email" placeholder="Email" required>


        <select id="cert-course"></select>
        <select id="cert-lang">
            <option value="en">English</option>
            <option value="hi">Hindi</option>
        </select>

        <button type="button" onclick="generateCertificateAdmin()">Generate</button>
    </form>

    <h3 style="margin-top:30px;">Certificate History</h3>
    <div class="admin-item-list" id="certificate-list"></div>
</div>

    <div id="certificate-preview-wrapper" style="display:none;">
        <h2>Certificate Preview</h2>

        <iframe id="certificate-preview"
                style="width:100%; height:520px; border:1px solid #ddd;">
        </iframe>

        <button id="print-certificate" class="primary-btn">
            Print / Download PDF
        </button>
    </div>
    </div>

            <div id="tab-shloka" class="content-page">
                <h1 class="page-header">Manage Shlokas</h1>
                <h2 id="shloka-form-title">Add New Shloka</h2>
                <form id="shloka-form">
                    <input type="hidden" id="shloka-id" value="">
                    <input type="text" id="adhyay" placeholder="Adhyay (e.g., 1)" required>
                    <input type="text" id="shloka" placeholder="Shloka (e.g., 2)" required>
                    <textarea id="text" placeholder="Shloka Text..." rows="4"></textarea>
                    <input type="text" id="video_url" placeholder="YouTube Video ID (Just the ID)" required>
                    <button type="submit" id="shloka-submit-button">Add Shloka</button>
                    <button type="button" id="shloka-cancel-edit" class="cancel-button" style="display: none;">Cancel Edit</button>
                </form>
                <h2 style="margin-top: 30px;">Existing Shlokas</h2>
                <div class="admin-item-list" id="shloka-list-admin"></div>
            </div>

            <div id="tab-blog" class="content-page">
                <h1 class="page-header">Manage Blog</h1>
                <h2 id="blog-form-title">Add New Blog Post</h2>
                <form id="blog-form">
                    <input type="hidden" id="blog-id" value="">
                    <input type="text" id="blog-title" placeholder="Blog Post Title" required>
                    <textarea id="blog-content" placeholder="Blog content..." rows="10" required></textarea>
                    <button type="submit" id="blog-submit-button">Add Post</button>
                    <button type="button" id="blog-cancel-edit" class="cancel-button" style="display: none;">Cancel Edit</button>
                </form>
                <h2 style="margin-top: 30px;">Existing Blog Posts</h2>
                <div class="admin-item-list" id="blog-list-admin"></div>
            </div>

            <div id="tab-artwork" class="content-page">
                <h1 class="page-header">Manage Artwork</h1>
                <h2>Add New Artwork</h2>
                <form id="artwork-form">
                    <input type="text" id="artwork-title" placeholder="Drawing Title (e.g., Ganesh Ji)" required>
                    <input type="text" id="artwork-url" placeholder="Paste image URL here (e.g., https://i.imgur.com/....jpg)" required>
                    <button type="submit">Add Artwork</button>
                </form>
                <h2 style="margin-top: 30px;">Existing Artwork</h2>
                <div class="admin-item-list" id="artwork-list"></div>
            </div>
            
            <div id="tab-about" class="content-page">
                <h1 class="page-header">Site Settings (About Page)</h1>
                <form id="about-form">
                    <h2>Update "About Aaradhya" Section</h2>
                    <label for="about-image-url">About Photo URL:</label>
                    <input type="text" id="about-image-url" placeholder="Paste image URL here (e.g., https://i.imgur.com/....jpg)">
                    <label for="about-text-input">About Text:</label>
                    <textarea id="about-text-input" rows="10" placeholder="Enter text for the 'About' section..."></textarea>
                    <button type="submit">Save About Text</button>
                </form>
            </div>

        </main>
    </div>

     <script>
document.addEventListener('DOMContentLoaded', () => {

    /* ================= BASIC SELECTORS ================= */

    const loginSection = document.getElementById('login-section');
    const adminDashboard = document.getElementById('admin-dashboard');
    const loginForm = document.getElementById('login-form');

    const sidebarButtons = document.querySelectorAll('.sidebar-button');
    const contentPages = document.querySelectorAll('.content-page');

    const shlokaListContainer = document.getElementById('shloka-list-admin');
    const artworkListContainer = document.getElementById('artwork-list');
    const blogListContainer = document.getElementById('blog-list-admin');
    const testimonialListPending = document.getElementById('testimonial-list-pending');
    const testimonialListApproved = document.getElementById('testimonial-list-approved');

    let adminPassword = '';

    /* ================= TAB SWITCHING (ONLY ONE PLACE) ================= */

    function activateTab(tabId) {
        sidebarButtons.forEach(b => b.classList.remove('active'));
        contentPages.forEach(p => p.classList.remove('active'));

        const btn = document.querySelector(`.sidebar-button[data-tab="${tabId}"]`);
        const page = document.getElementById(tabId);

        if (!btn || !page) return;

        btn.classList.add('active');
        page.classList.add('active');

        window.scrollTo({ top: 0, behavior: 'instant' });

        switch (tabId) {
            case 'tab-shloka': loadShlokasAdmin(); break;
            case 'tab-artwork': loadArtwork(); break;
            case 'tab-blog': loadBlogPosts(); break;
            case 'tab-testimonials': loadTestimonials(); break;
            case 'tab-courses': loadCoursesAdmin(); break;
            case 'tab-quizzes': loadCoursesForQuiz(); loadQuizzes(); break;
            case 'tab-certificates': loadCoursesForCertificate(); loadCertificates(); break;
        }
    }

    sidebarButtons.forEach(btn => {
        btn.addEventListener('click', () => activateTab(btn.dataset.tab));
    });

    /* ================= LOGIN ================= */

    loginForm.addEventListener('submit', async e => {
        e.preventDefault();

        const password = document.getElementById('password').value;

        const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password })
        });

        const data = await res.json();

        if (!data.success) {
            alert('Login failed');
            return;
        }

        adminPassword = password;
        loginSection.style.display = 'none';
        adminDashboard.style.display = 'flex';

        activateTab('tab-dashboard');
        loadShlokasAdmin();
        loadArtwork();
        loadBlogPosts();
        loadTestimonials();
    });

    /* ================= SHLOKAS ================= */

    async function loadShlokasAdmin() {
        if (!shlokaListContainer) return;

        const r = await fetch('/api/shlokas');
        const shlokas = await r.json();

        shlokaListContainer.innerHTML = '';
        let likes = 0;

        shlokas.forEach(s => {
            likes += s.likes || 0;
            shlokaListContainer.innerHTML += `
                <div class="shloka-admin-item">
                    <p><b>Adhyay ${s.adhyay}, Shloka ${s.shloka}</b> (Likes: ${s.likes || 0})</p>
                    <div class="admin-buttons">
                        <button class="delete-button" data-id="${s._id}">Delete</button>
                    </div>
                </div>
            `;
        });

        document.getElementById('stat-shlokas').textContent = shlokas.length;
        document.getElementById('stat-likes').textContent = likes;
    }

    /* ================= ARTWORK ================= */

    async function loadArtwork() {
        if (!artworkListContainer) return;

        const r = await fetch('/api/artwork');
        const list = await r.json();

        artworkListContainer.innerHTML = '';
        list.forEach(a => {
            artworkListContainer.innerHTML += `
                <div class="artwork-admin-item">
                    <img src="${a.imageUrl}">
                    <p>${a.title}</p>
                    <div class="admin-buttons">
                        <button class="delete-button" data-id="${a._id}">Delete</button>
                    </div>
                </div>
            `;
        });

        document.getElementById('stat-artwork').textContent = list.length;
    }

    /* ================= BLOG ================= */

    async function loadBlogPosts() {
        if (!blogListContainer) return;

        const r = await fetch('/api/blog');
        const posts = await r.json();

        blogListContainer.innerHTML = '';
        posts.forEach(p => {
            blogListContainer.innerHTML += `
                <div class="shloka-admin-item">
                    <p><b>${p.title}</b></p>
                    <div class="admin-buttons">
                        <button class="delete-button" data-id="${p._id}">Delete</button>
                    </div>
                </div>
            `;
        });

        document.getElementById('stat-blog').textContent = posts.length;
    }

    /* ================= TESTIMONIALS ================= */

    async function loadTestimonials() {
        const r = await fetch('/api/testimonials/all');
        const list = await r.json();

        testimonialListPending.innerHTML = '';
        testimonialListApproved.innerHTML = '';

        let pending = 0;

        list.forEach(t => {
            const div = document.createElement('div');
            div.className = 'shloka-admin-item';

            if (t.status === 'pending') {
                pending++;
                div.innerHTML = `<p>${t.author}</p>`;
                testimonialListPending.appendChild(div);
            } else {
                div.innerHTML = `<p>${t.author}</p>`;
                testimonialListApproved.appendChild(div);
            }
        });

        document.getElementById('stat-pending').textContent = pending;
    }

    /* ================= COURSES ================= */

    async function loadCoursesAdmin() {
        const box = document.getElementById('course-list');
        if (!box) return;

        const r = await fetch('/api/courses');
        const list = await r.json();

        box.innerHTML = '';
        list.forEach(c => {
            box.innerHTML += `
                <div class="shloka-admin-item">
                    <p><b>${c.title}</b><br>Adhyay ${c.adhyay}</p>
                    <div class="admin-buttons">
                        <button class="delete-course" data-id="${c._id}">ðŸ—‘ Delete</button>
                    </div>
                </div>
            `;
        });
    }

    /* ================= QUIZ ================= */

    async function loadCoursesForQuiz() {
        const sel = document.getElementById('quiz-course');
        if (!sel) return;

        const r = await fetch('/api/courses');
        const list = await r.json();

        sel.innerHTML = '<option value="">Select Course</option>';
        list.forEach(c => {
            sel.innerHTML += `<option value="${c._id}">${c.title}</option>`;
        });
    }

    async function loadQuizzes() {
        const box = document.getElementById('quiz-list');
        if (!box) return;

        const r = await fetch('/api/quiz');
        const list = await r.json();

        box.innerHTML = '';
        list.forEach(q => {
            box.innerHTML += `
                <div class="shloka-admin-item">
                    <p><b>${q.course?.title || 'Unknown'}</b> (Pass: ${q.passPercentage}%)</p>
                </div>
            `;
        });
    }

    /* ================= CERTIFICATES ================= */

    async function loadCoursesForCertificate() {
        const sel = document.getElementById('cert-course');
        if (!sel) return;

        const r = await fetch('/api/courses');
        const list = await r.json();

        sel.innerHTML = '<option value="">Select Course</option>';
        list.forEach(c => {
            sel.innerHTML += `<option value="${c._id}">${c.title}</option>`;
        });
    }

    async function loadCertificates() {
        const box = document.getElementById('certificate-list');
        if (!box) return;

        const r = await fetch('/api/certificates');
        const list = await r.json();

        box.innerHTML = '';
        list.forEach(c => {
            box.innerHTML += `
                <div class="admin-item">
                    <b>${c.name}</b> â€“ ${c.courseTitle}
                </div>
            `;
        });
    }

});
</script>
</body>
</html>