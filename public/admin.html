<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="admin-style.css"> 
</head>
<body>

    <body>

<!-- LOGIN -->
<div id="login-section">
    <form id="login-form">
        <h2>Admin Login</h2>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
    </form>
</div>

<!-- DASHBOARD -->
<div id="admin-dashboard" class="admin-wrapper" style="display:none;">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">Admin Panel</div>
        <nav class="sidebar-nav">
            <button class="sidebar-button active" data-tab="tab-dashboard">Dashboard</button>
            <button class="sidebar-button" data-tab="tab-testimonials">Testimonials</button>
            <button class="sidebar-button" data-tab="tab-shloka">Manage Shlokas</button>
            <button class="sidebar-button" data-tab="tab-blog">Manage Blog</button>
            <button class="sidebar-button" data-tab="tab-artwork">Manage Artwork</button>
            <button class="sidebar-button" data-tab="tab-courses">Manage Courses</button>
            <button class="sidebar-button" data-tab="tab-quizzes">Manage Quizzes</button>
            <button class="sidebar-button" data-tab="tab-certificates">Manage Certificates</button>
            <button class="sidebar-button" data-tab="tab-about">Site Settings (About)</button>
        </nav>
    </aside>

    <!-- MAIN CONTENT (IMPORTANT: ALL TABS INSIDE THIS) -->
    <main class="main-content">

        <!-- DASHBOARD -->
        <div id="tab-dashboard" class="content-page active">
            <h1>Dashboard</h1>
            <div class="dashboard-stats">
                <div class="stat-card"><h3>Pending Testimonials</h3><span id="stat-pending">0</span></div>
                <div class="stat-card"><h3>Total Shlokas</h3><span id="stat-shlokas">0</span></div>
                <div class="stat-card"><h3>Total Likes</h3><span id="stat-likes">0</span></div>
                <div class="stat-card"><h3>Blog Posts</h3><span id="stat-blog">0</span></div>
                <div class="stat-card"><h3>Artworks</h3><span id="stat-artwork">0</span></div>
            </div>
        </div>

        <!-- TESTIMONIALS -->
        <div id="tab-testimonials" class="content-page">
            <h1>Manage Testimonials</h1>
            <div id="testimonial-list-pending"></div>
            <div id="testimonial-list-approved"></div>
        </div>

        <!-- SHLOKAS -->
        <div id="tab-shloka" class="content-page">
            <h1>Manage Shlokas</h1>
            <form id="shloka-form">
                <input type="hidden" id="shloka-id">
                <input id="adhyay" placeholder="Adhyay" required>
                <input id="shloka" placeholder="Shloka" required>
                <textarea id="text" placeholder="Text"></textarea>
                <input id="video_url" placeholder="YouTube Video ID">
                <button type="submit">Save</button>
            </form>
            <div id="shloka-list-admin"></div>
        </div>

        <!-- BLOG -->
        <div id="tab-blog" class="content-page">
            <h1>Manage Blog</h1>
            <form id="blog-form">
                <input type="hidden" id="blog-id">
                <input id="blog-title" placeholder="Title" required>
                <textarea id="blog-content" placeholder="Content"></textarea>
                <button type="submit">Save</button>
            </form>
            <div id="blog-list-admin"></div>
        </div>

        <!-- ARTWORK -->
        <div id="tab-artwork" class="content-page">
            <h1>Manage Artwork</h1>
            <form id="artwork-form">
                <input id="artwork-title" placeholder="Title" required>
                <input id="artwork-url" placeholder="Image URL" required>
                <button type="submit">Add</button>
            </form>
            <div id="artwork-list"></div>
        </div>

        <!-- COURSES -->
        <div id="tab-courses" class="content-page">
            <h1>Manage Courses</h1>
            <button id="show-course-form">âž• Add Course</button>
            <div id="course-form-wrapper" style="display:none;">
                <form id="course-form">
                    <input id="course-title" placeholder="Title" required>
                    <textarea id="course-description"></textarea>
                    <select id="course-adhyay"></select>
                    <div id="course-shloka-list"></div>
                    <button type="submit">Save</button>
                </form>
            </div>
            <div id="course-list"></div>
        </div>

        <!-- QUIZZES -->
        <div id="tab-quizzes" class="content-page">
            <h1>Manage Quizzes</h1>
            <select id="quiz-course"></select>
            <input id="quiz-pass" value="50">
            <div id="quiz-questions"></div>
            <button id="add-question">Add Question</button>
            <button id="quiz-save">Save Quiz</button>
            <div id="quiz-list"></div>
        </div>

        <!-- CERTIFICATES -->
        <div id="tab-certificates" class="content-page">
            <h1>Certificates</h1>
            <input id="cert-name" placeholder="Name">
            <input id="cert-mobile" placeholder="Mobile">
            <input id="cert-email" placeholder="Email">
            <select id="cert-course"></select>
            <select id="cert-lang">
                <option value="en">English</option>
                <option value="hi">Hindi</option>
            </select>
            <button type="button" onclick="generateCertificate()">Generate</button>
            <div id="certificate-list"></div>
        </div>

        <!-- ABOUT -->
        <div id="tab-about" class="content-page">
            <h1>About Page</h1>
            <form id="about-form">
                <input id="about-image-url" placeholder="Image URL">
                <textarea id="about-text-input"></textarea>
                <button type="submit">Save</button>
            </form>
        </div>

    </main>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {

const loginForm = document.getElementById('login-form');
const loginSection = document.getElementById('login-section');
const adminDashboard = document.getElementById('admin-dashboard');
const sidebarButtons = document.querySelectorAll('.sidebar-button');
const pages = document.querySelectorAll('.content-page');

let adminPassword = '';

/* LOGIN */
loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    const password = document.getElementById('password').value;

    const r = await fetch('/api/login', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({password})
    });

    const d = await r.json();
    if(!d.success) return alert('Wrong password');

    adminPassword = password;
    loginSection.style.display='none';
    adminDashboard.style.display='flex';

    loadDashboard();
loadTestimonials();
loadShlokasAdmin();
loadBlogPosts();
loadArtwork();
loadCoursesAdmin?.();
loadCertificates?.();
loadQuizzes?.();
loadAboutContent();
loadCoursesForCertificate();
});

/* TAB SWITCH + DATA LOAD */
sidebarButtons.forEach(btn => {
    btn.onclick = () => {

        sidebarButtons.forEach(b => b.classList.remove('active'));
        pages.forEach(p => p.classList.remove('active'));

        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.getElementById(tab).classList.add('active');

        // ðŸ”¥ YAHI MAIN FIX HAI
        if (tab === 'tab-dashboard') loadDashboard();
        if (tab === 'tab-testimonials') loadTestimonials();
        if (tab === 'tab-shloka') loadShlokasAdmin();
        if (tab === 'tab-blog') loadBlogPosts();
        if (tab === 'tab-artwork') loadArtwork();
        if (tab === 'tab-courses') loadCoursesAdmin?.();
        if (tab === 'tab-certificates') loadCertificates?.();
        if (tab === 'tab-quizzes') loadQuizzes?.();
        if (tab === 'tab-about') loadAboutContent();
    };
});

/* DASHBOARD */
async function loadDashboard() {

    const shlokas = await fetch('/api/shlokas').then(r => r.json());
    const blogs   = await fetch('/api/blog').then(r => r.json());
    const artwork = await fetch('/api/artwork').then(r => r.json());
    const testi   = await fetch('/api/testimonials/all').then(r => r.json());

    let likes = 0;
    shlokas.forEach(s => likes += (s.likes || 0));

    document.getElementById('stat-shlokas').textContent = shlokas.length;
    document.getElementById('stat-likes').textContent  = likes;
    document.getElementById('stat-blog').textContent   = blogs.length;
    document.getElementById('stat-artwork').textContent= artwork.length;

    const pending = testi.filter(t => t.status === 'pending').length;
    document.getElementById('stat-pending').textContent = pending;
}

/* SHLOKAS */
async function loadShlokasAdmin(){
    const r=await fetch('/api/shlokas');
    const list=await r.json();
    const box=document.getElementById('shloka-list-admin');
    box.innerHTML='';
    list.forEach(s=>{
        box.innerHTML+=`
        <div>
            ${s.adhyay}.${s.shloka}
            <button onclick="deleteShloka('${s._id}')">Delete</button>
        </div>`;
    });
}
window.deleteShloka=async id=>{
    await fetch('/api/shlokas/'+id,{method:'DELETE',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({password:adminPassword})
    });
    loadShlokasAdmin();
};
async function loadBlogPosts() {
    const res = await fetch('/api/blog');
    const posts = await res.json();

    const box = document.getElementById('blog-list-admin');
    box.innerHTML = '';

    posts.forEach(p => {
        box.innerHTML += `
            <div class="shloka-admin-item">
                <b>${p.title}</b>
                <div class="admin-buttons">
                    <button class="delete-button" onclick="deleteBlog('${p._id}')">Delete</button>
                </div>
            </div>
        `;
    });
}

async function deleteBlog(id) {
    await fetch('/api/blog/' + id, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: adminPassword })
    });
    loadBlogPosts();
}

async function loadArtwork() {
    const res = await fetch('/api/artwork');
    const items = await res.json();

    const box = document.getElementById('artwork-list');
    box.innerHTML = '';

    items.forEach(a => {
        box.innerHTML += `
            <div class="artwork-admin-item">
                <img src="${a.imageUrl}">
                <b>${a.title}</b>
                <button class="delete-button" onclick="deleteArtwork('${a._id}')">Delete</button>
            </div>
        `;
    });
}

async function deleteArtwork(id) {
    await fetch('/api/artwork/' + id, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: adminPassword })
    });
    loadArtwork();
}

async function loadCoursesAdmin() {
    const res = await fetch('/api/courses');
    const courses = await res.json();

    const box = document.getElementById('course-list');
    box.innerHTML = '';

    courses.forEach(c => {
        box.innerHTML += `
            <div class="shloka-admin-item">
                <b>${c.title}</b> (Adhyay ${c.adhyay})
                <button class="delete-button" onclick="deleteCourse('${c._id}')">Delete</button>
            </div>
        `;
    });
}

async function deleteCourse(id) {
    await fetch('/api/courses/' + id, { method: 'DELETE' });
    loadCoursesAdmin();
}

async function loadQuizzes() {
    const res = await fetch('/api/quiz');
    const quizzes = await res.json();

    const box = document.getElementById('quiz-list');
    box.innerHTML = '';

    quizzes.forEach(q => {
        box.innerHTML += `
            <div class="shloka-admin-item">
                <b>${q.course?.title || 'Unknown Course'}</b>
                (Pass: ${q.passPercentage}%)
            </div>
        `;
    });
}

async function loadCertificates() {
    const res = await fetch('/api/certificates');
    const list = await res.json();

    const box = document.getElementById('certificate-list');
    box.innerHTML = '';

    list.forEach(c => {
        box.innerHTML += `
            <div class="shloka-admin-item">
                <b>${c.name}</b> â€“ ${c.courseTitle}
                <br>${c.mobile}
            </div>
        `;
    });
}

/* ================= CERTIFICATE COURSES LOAD ================= */
async function loadCoursesForCertificate() {
    try {
        const res = await fetch('/api/courses');
        const courses = await res.json();

        const sel = document.getElementById('cert-course');
        sel.innerHTML = '<option value="">Select Course</option>';

        courses.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c._id;
            opt.textContent = c.title;
            sel.appendChild(opt);
        });
    } catch (err) {
        console.error('Failed to load courses for certificate', err);
    }
}

/* ================= CERTIFICATE GENERATE ================= */
window.generateCertificate = function () {

    const name   = document.getElementById('cert-name').value;
    const mobile = document.getElementById('cert-mobile').value;
    const email  = document.getElementById('cert-email').value;

    const courseSelect = document.getElementById('cert-course');
    const courseTitle  = courseSelect.selectedOptions[0]?.text;

    const lang = document.getElementById('cert-lang').value;

    if (!name || !courseTitle) {
        alert('Please fill name and select course');
        return;
    }

    const url =
        `/api/certificate?name=${encodeURIComponent(name)}` +
        `&mobile=${mobile}` +
        `&email=${encodeURIComponent(email)}` +
        `&courseTitle=${encodeURIComponent(courseTitle)}` +
        `&lang=${lang}`;

    window.open(url, '_blank');
};


/* ================= ABOUT LOAD ================= */
async function loadAboutContent() {
    try {
        const res = await fetch('/api/about');
        const data = await res.json();

        document.getElementById('about-text-input').value = data.content || '';
        document.getElementById('about-image-url').value = data.imageUrl || '';
    } catch (err) {
        console.error('Failed to load about content', err);
    }
}


/* TESTIMONIALS */
async function loadTestimonials(){
    const r=await fetch('/api/testimonials/all');
    const list=await r.json();
    document.getElementById('testimonial-list-pending').innerHTML=
        list.filter(t=>t.status==='pending').map(t=>`<div>${t.author}</div>`).join('');
}

});
</script>
</body>
</html>