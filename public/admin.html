<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaradhya Geetaji | Admin Panel</title>

    <!-- Favicon -->
    <link rel="icon" href="/favicon.png">

    <!-- Styles -->
    <link rel="stylesheet" href="admin-style.css">
</head>
<body>

<!-- ================= LOGIN ================= -->
<div id="login-section">
    <div class="login-card">
        <h2>Admin Login</h2>
        <p>Authorized access only</p>

        <form id="login-form">
            <input 
                type="password" 
                id="password" 
                class="form-control" 
                placeholder="Admin Password" 
                required
            >
            <button class="btn btn-primary" style="width:100%;margin-top:1rem">
                Login
            </button>
        </form>
    </div>
</div>

<!-- ================= ADMIN LAYOUT ================= -->
<div id="admin-layout" class="admin-layout" style="display:none;">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="brand">⚡ AdminOS</div>

        <div class="nav-scroll">

            <div class="nav-group">
                <div class="nav-label">Overview</div>
                <div class="nav-item active" onclick="switchTab('dashboard')">
                    Dashboard
                </div>
            </div>

            <div class="nav-group">
                <div class="nav-label">CMS</div>
                <div class="nav-item" onclick="switchTab('shlokas')">Shlokas</div>
                <div class="nav-item" onclick="switchTab('blogs')">Blogs</div>
                <div class="nav-item" onclick="switchTab('artwork')">Artwork</div>
                <div class="nav-item" onclick="switchTab('testimonials')">Testimonials</div>
            </div>

            <div class="nav-group">
                <div class="nav-label">LMS</div>
                <div class="nav-item" onclick="switchTab('courses')">Courses</div>
                <div class="nav-item" onclick="switchTab('quizzes')">Quizzes</div>
                <div class="nav-item" onclick="switchTab('certificates')">Certificates</div>
                <div class="nav-item" onclick="switchTab('students')">Students</div>
            </div>

            <div class="nav-group">
                <div class="nav-label">System</div>
                <div class="nav-item" onclick="switchTab('settings')">Settings</div>
            </div>

        </div>

        <div class="sidebar-footer">
            <button class="logout-btn" onclick="location.reload()">Logout</button>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="main-wrapper">

        <header class="top-header">
            <div class="page-title" id="page-title">
                Dashboard
            </div>
        </header>

        <div class="content-scroll">
            <!-- ================= DASHBOARD ================= -->
            <div id="view-dashboard" class="view-section active">
                <div class="stats-grid" id="stats-grid"></div>

                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Pending Actions</h3>
                    </div>
                    <div class="modal-body" id="dashboard-alerts">
                        <!-- JS fills -->
                    </div>
                </div>
            </div>

            <!-- ================= SHLOKAS ================= -->
            <div id="view-shlokas" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Shlokas</h3>
                        <button class="btn btn-primary btn-sm" onclick="openShlokaModal()">+ Add Shloka</button>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Adhyay</th>
                                    <th>Shloka</th>
                                    <th>Text</th>
                                    <th style="text-align:right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-shlokas"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= BLOGS ================= -->
            <div id="view-blogs" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Blogs</h3>
                        <button class="btn btn-primary btn-sm" onclick="openBlogModal()">+ New Blog</button>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Date</th>
                                    <th style="text-align:right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-blogs"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= ARTWORK ================= -->
            <div id="view-artwork" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Artwork Gallery</h3>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Preview</th>
                                    <th>Title</th>
                                    <th style="text-align:right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-artwork"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= COURSES ================= -->
            <div id="view-courses" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Courses</h3>
                        <button class="btn btn-primary btn-sm" onclick="openCourseForm()">+ New Course</button>
                    </div>

                    <div id="course-list-container" style="padding:1.5rem;"></div>
                </div>
            </div>

            <!-- ================= QUIZZES ================= -->
            <div id="view-quizzes" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Quizzes</h3>
                        <button class="btn btn-primary btn-sm" onclick="openQuizForm()">+ Create Quiz</button>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Course</th>
                                    <th>Pass %</th>
                                    <th style="text-align:right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-quizzes"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= CERTIFICATES ================= -->
            <div id="view-certificates" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Certificates</h3>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Course</th>
                                    <th>Status</th>
                                    <th style="text-align:right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-certs"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= STUDENTS ================= -->
            <div id="view-students" class="view-section">
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">Students</h3>
                    </div>

                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Mobile</th>
                                    <th>Progress</th>
                                    <th>Quiz</th>
                                </tr>
                            </thead>
                            <tbody id="table-students"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= SETTINGS ================= -->
            <div id="view-settings" class="view-section">
                <div class="form-grid-2">

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">About Page</h3>
                        </div>
                        <div class="modal-body">
                            <form id="settings-form">
                                <div class="form-group">
                                    <label class="form-label">Image URL</label>
                                    <input id="abt-img" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Content</label>
                                    <textarea id="abt-content" class="form-control" style="min-height:150px"></textarea>
                                </div>

                                <button class="btn btn-primary">Save</button>
                            </form>
                        </div>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">Push Notification</h3>
                        </div>
                        <div class="modal-body">
                            <input id="push-title" class="form-control" placeholder="Title">
                            <textarea id="push-msg" class="form-control" placeholder="Message"
                                style="margin-top:10px"></textarea>
                            <button class="btn btn-primary" style="margin-top:10px" onclick="sendPush()">
                                Send Push
                            </button>
                        </div>
                    </div>

                </div>
            </div>

        </div> <!-- content-scroll -->
    </main>
</div>

<!-- ================= MODALS ================= -->

<!-- SHLOKA MODAL -->
<div class="modal-overlay" id="shloka-modal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h3>Shloka</h3>
            <button class="btn btn-secondary btn-sm" onclick="closeModal('shloka-modal')">X</button>
        </div>
        <div class="modal-body">
            <form id="shloka-form">
                <input type="hidden" id="shloka-id">

                <div class="form-grid-2">
                    <input id="s-adhyay" class="form-control" placeholder="Adhyay" required>
                    <input id="s-shloka" class="form-control" placeholder="Shloka" required>
                </div>

                <textarea id="s-text" class="form-control" placeholder="Text"
                    style="margin-top:10px"></textarea>

                <input id="s-vid" class="form-control" placeholder="YouTube Video ID"
                    style="margin-top:10px">

                <button class="btn btn-primary" style="margin-top:10px;width:100%">Save</button>
            </form>
        </div>
    </div>
</div>

<!-- BLOG MODAL -->
<div class="modal-overlay" id="blog-modal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h3>Blog</h3>
            <button class="btn btn-secondary btn-sm" onclick="closeModal('blog-modal')">X</button>
        </div>
        <div class="modal-body">
            <form id="blog-form">
                <input id="b-title" class="form-control" placeholder="Title" required>
                <input id="b-img" class="form-control" placeholder="Image URL" style="margin-top:10px">
                <textarea id="b-content" class="form-control" placeholder="Content"
                    style="margin-top:10px;min-height:200px"></textarea>
                <button class="btn btn-primary" style="margin-top:10px">Publish</button>
            </form>
        </div>
    </div>
</div>
<script>
/* ======================================================
   GLOBAL STATE
====================================================== */
let adminPassword = '';

/* ======================================================
   HELPERS
====================================================== */
function qs(id) {
    return document.getElementById(id);
}

function closeModal(id) {
    qs(id).classList.remove('open');
}

function openModal(id) {
    qs(id).classList.add('open');
}

/* ======================================================
   AUTH
====================================================== */
qs('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const pwd = qs('password').value;

    try {
        const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: pwd })
        });

        if (!res.ok) {
            alert('Wrong password');
            return;
        }

        adminPassword = pwd;
        qs('login-section').style.display = 'none';
        qs('admin-layout').style.display = 'grid';

        switchTab('dashboard');
    } catch (err) {
        alert('Server error');
    }
});

/* ======================================================
   NAVIGATION
====================================================== */
function switchTab(tab) {
    document.querySelectorAll('.view-section')
        .forEach(v => v.classList.remove('active'));

    qs('view-' + tab).classList.add('active');
    qs('page-title').innerText =
        tab.charAt(0).toUpperCase() + tab.slice(1);

    if (tab === 'dashboard') loadDashboard();
    if (tab === 'shlokas') loadShlokas();
    if (tab === 'blogs') loadBlogs();
    if (tab === 'artwork') loadArtwork();
    if (tab === 'courses') loadCourses();
    if (tab === 'quizzes') loadQuizzes();
    if (tab === 'certificates') loadCertificates();
    if (tab === 'students') loadStudents();
    if (tab === 'settings') loadSettings();
}

/* ======================================================
   DASHBOARD
====================================================== */
async function loadDashboard() {
    const grid = qs('stats-grid');
    grid.innerHTML = '';

    const [s, b, a, c, q] = await Promise.all([
        fetch('/api/shlokas').then(r => r.json()),
        fetch('/api/blog').then(r => r.json()),
        fetch('/api/artwork').then(r => r.json()),
        fetch('/api/courses').then(r => r.json()),
        fetch('/api/quiz').then(r => r.json())
    ]);

    const stats = [
        ['Shlokas', s.length],
        ['Blogs', b.length],
        ['Artwork', a.length],
        ['Courses', c.length],
        ['Quizzes', q.length]
    ];

    stats.forEach(item => {
        grid.innerHTML += `
            <div class="stat-card">
                <div class="stat-head">${item[0]}</div>
                <div class="stat-value">${item[1]}</div>
            </div>`;
    });
}

/* ======================================================
   SHLOKAS
====================================================== */
async function loadShlokas() {
    const tb = qs('table-shlokas');
    tb.innerHTML = '';

    const data = await fetch('/api/shlokas').then(r => r.json());

    data.forEach(s => {
        tb.innerHTML += `
        <tr>
            <td>${s.adhyay}</td>
            <td>${s.shloka}</td>
            <td>${(s.text || '').slice(0, 40)}</td>
            <td style="text-align:right">
                <button class="btn btn-danger btn-sm"
                    onclick="deleteShloka('${s._id}')">Delete</button>
            </td>
        </tr>`;
    });
}

async function deleteShloka(id) {
    if (!confirm('Delete shloka?')) return;

    await fetch('/api/shlokas/' + id, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: adminPassword })
    });

    loadShlokas();
}

/* ======================================================
   BLOGS
====================================================== */
async function loadBlogs() {
    const tb = qs('table-blogs');
    tb.innerHTML = '';

    const data = await fetch('/api/blog').then(r => r.json());

    data.forEach(b => {
        tb.innerHTML += `
        <tr>
            <td>${b.title}</td>
            <td>${new Date(b.createdAt).toLocaleDateString()}</td>
            <td style="text-align:right">
                <button class="btn btn-danger btn-sm"
                    onclick="deleteBlog('${b._id}')">Delete</button>
            </td>
        </tr>`;
    });
}

async function deleteBlog(id) {
    await fetch('/api/blog/' + id, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: adminPassword })
    });

    loadBlogs();
}

/* ======================================================
   ARTWORK
====================================================== */
async function loadArtwork() {
    const tb = qs('table-artwork');
    tb.innerHTML = '';

    const data = await fetch('/api/artwork').then(r => r.json());

    data.forEach(a => {
        tb.innerHTML += `
        <tr>
            <td><img src="${a.imageUrl}" style="height:40px"></td>
            <td>${a.title}</td>
            <td style="text-align:right">
                <button class="btn btn-danger btn-sm"
                    onclick="deleteArtwork('${a._id}')">Delete</button>
            </td>
        </tr>`;
    });
}

async function deleteArtwork(id) {
    await fetch('/api/artwork/' + id, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: adminPassword })
    });

    loadArtwork();
}

/* ======================================================
   COURSES
====================================================== */
async function loadCourses() {
    const box = qs('course-list-container');
    box.innerHTML = '';

    const data = await fetch('/api/courses').then(r => r.json());

    data.forEach(c => {
        box.innerHTML += `
        <div class="data-card" style="margin-bottom:1rem">
            <div class="card-header">
                <b>${c.title}</b>
                <button class="btn btn-danger btn-sm"
                    onclick="deleteCourse('${c._id}')">Delete</button>
            </div>
        </div>`;
    });
}

async function deleteCourse(id) {
    if (!confirm('Delete course?')) return;
    await fetch('/api/courses/' + id, { method: 'DELETE' });
    loadCourses();
}

/* ======================================================
   QUIZZES
====================================================== */
async function loadQuizzes() {
    const tb = qs('table-quizzes');
    tb.innerHTML = '';

    const data = await fetch('/api/quiz').then(r => r.json());

    data.forEach(q => {
        tb.innerHTML += `
        <tr>
            <td>${q.course?.title || '—'}</td>
            <td>${q.passPercentage}%</td>
            <td style="text-align:right">
                <button class="btn btn-danger btn-sm"
                    onclick="deleteQuiz('${q._id}')">Delete</button>
            </td>
        </tr>`;
    });
}

async function deleteQuiz(id) {
    await fetch('/api/quiz/' + id, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: adminPassword })
    });

    loadQuizzes();
}

/* ======================================================
   CERTIFICATES
====================================================== */
async function loadCertificates() {
    const tb = qs('table-certs');
    tb.innerHTML = '';

    const data = await fetch('/api/certificates').then(r => r.json());

    data.forEach(c => {
        tb.innerHTML += `
        <tr>
            <td>${c.name}</td>
            <td>${c.courseTitle}</td>
            <td>${c.status}</td>
            <td style="text-align:right">
                <button class="btn btn-danger btn-sm"
                    onclick="deleteCert('${c._id}')">Delete</button>
            </td>
        </tr>`;
    });
}

async function deleteCert(id) {
    await fetch('/api/certificates/' + id, { method: 'DELETE' });
    loadCertificates();
}

/* ======================================================
   STUDENTS
====================================================== */
function loadStudents() {
    qs('table-students').innerHTML =
        '<tr><td colspan="3">Progress is tracked automatically</td></tr>';
}

/* ======================================================
   SETTINGS
====================================================== */
async function loadSettings() {
    const data = await fetch('/api/about').then(r => r.json());
    qs('abt-img').value = data.imageUrl || '';
    qs('abt-content').value = data.content || '';
}

qs('settings-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    await fetch('/api/about', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            newText: qs('abt-content').value,
            newImageUrl: qs('abt-img').value,
            password: adminPassword
        })
    });

    alert('Saved');
});

/* ======================================================
   PUSH
====================================================== */
async function sendPush() {
    await fetch('/api/push/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            title: qs('push-title').value,
            body: qs('push-msg').value,
            password: adminPassword
        })
    });

    alert('Push sent');
}
</script>
