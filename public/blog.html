<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post - Warrior Aaradhya</title>
    <link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="style.css">
    </head>
<body>
    
    <nav class="top-navbar">
        <div class="container nav-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: #D84315;">Warrior Aaradhya</a>
            </div>
            <div class="shloka-nav-links">
                <a href="index.html" class="home-button">Home</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <main id="single-blog-container">
            <p>Loading blog post...</p>
        </main>
    </div>

    <footer class="footer">
        <p>Contact: Aaradhya Soni</p>
        <p>Email: warrioraaradhya111@gmail.com</p>
        <p>Whatsapp: +91 9243714402</p>
        <p>&copy; 2025 Vedang Soni. All Rights Reserved.</p>
    </footer>

    <script>
        // Single blog post card banane ka function
        function createSingleBlogCard(post) {
            const item = document.createElement('article');
            item.className = 'blog-post-item'; // Puraana style reuse karein
            
            const postDate = new Date(post.createdAt).toLocaleDateString('en-IN', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
            
            const isLiked = localStorage.getItem('liked_blog_' + post._id) === 'true';
            
            // Share data
            const shareTitle = post.title + " - by Warrior Aaradhya";
            const shareText = "Check out this blog post from Warrior Aaradhya!";
            const shareUrl = window.location.href; 

            item.innerHTML = `
                <h3>${post.title}</h3>
                <p class="blog-date">${postDate}</p>
                <div class="blog-content">
                    ${post.content.replace(/\n/g, '<br>')}
                </div>
                <div class="shloka-actions">
                    <button class="shloka-action-button like-button" data-id="${post._id}" ${isLiked ? 'disabled' : ''}>
                        ‚ù§Ô∏è <span class="like-count">${post.likes || 0}</span>
                    </button>
                    <button class="shloka-action-button share-button" 
                            data-url="${shareUrl}" 
                            data-title="${shareTitle}" 
                            data-text="${shareText}">
                        üîó Share
                    </button>
                </div>
            `;
            return item;
        }

        // Page load hone par post fetch karo
        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('single-blog-container');
            const params = new URLSearchParams(window.location.search);
            const postId = params.get('id');

            if (!postId) {
                container.innerHTML = "<p>Error: No post ID provided.</p>";
                return;
            }

            try {
                const cacheBuster = `?cache_buster=${new Date().getTime()}`;
                const response = await fetch(`/api/blog/${postId}${cacheBuster}`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Blog post not found');
                }
                const post = await response.json();
                
                container.innerHTML = ''; 
                const blogCard = createSingleBlogCard(post);
                container.appendChild(blogCard);

            } catch (err) {
                console.error(err);
                container.innerHTML = `<p>Error: ${err.message}</p>`;
            }
            
            // --- [NAYA FIX] ---
            // Click listener ko DOMContentLoaded ke ANDAR yahaan move kar diya hai
            // Taaki yeh content load hone ke BAAD attach ho
            document.getElementById('single-blog-container').addEventListener('click', async (e) => {
                const shareButton = e.target.closest('.share-button');
                if (shareButton) {
                    const urlToShare = shareButton.dataset.url;
                    const title = shareButton.dataset.title;
                    const text = shareButton.dataset.text;
                    if (navigator.share) {
                        try { await navigator.share({ title: title, text: text, url: urlToShare }); } 
                        catch (err) { console.error('Share failed:', err); }
                    } else {
                        try { await navigator.clipboard.writeText(urlToShare); alert('Link copied to clipboard!'); } 
                        catch (err) { alert('Failed to copy link.'); }
                    }
                }
                
                const likeButton = e.target.closest('.like-button');
                if (likeButton) {
                    const postId = likeButton.dataset.id;
                    const key = 'liked_blog_' + postId;
                    if (localStorage.getItem(key)) { return; }
                    
                    likeButton.disabled = true;
                    try {
                        const response = await fetch(`/api/blog/like/${postId}`, { method: 'POST' });
                        const data = await response.json();
                        if (data.success) {
                            likeButton.querySelector('.like-count').textContent = data.likes;
                            localStorage.setItem(key, 'true');
                        } else {
                            likeButton.disabled = false;
                        }
                    } catch (err) {
                        likeButton.disabled = false;
                    }
                }
            });
            // --- FIX END ---
        });
        
    </script>
</body>
</html>